{
  "openrpc": "1.0.0-rc1",
  "info": {
    "title": "Authenticated Anonymity Architecture (AAA) Smart Contract RPC",
    "version": "0.0.1",
    "description": "This specification describes the Remote Procedure Call (RPC) interface for interacting directly with the AAA Smart Contracts deployed on the blockchain.",
    "license": {
      "name": "MIT"
    },
    "contact": {
      "name": "AAA Team",
      "email": "doesntexist@aaa.org",
      "url": "https://aaa.org"
    }
  },
  "servers": [
    {
      "url": "https://dev.aaa.com",
      "description": "Development endpoint for AAA Smart Contract interactions"
    },
    {
      "url": "https://prod.aaa.com",
      "description": "Primary endpoint for AAA Smart Contract interactions"
    }
  ],
  "methods": [
    {
      "name": "generateSeedPhrase",
      "summary": "Initiates the seed phrase generation protocol on-chain.",
      "description": "The smart contract records the user's request and provided Public Key, triggering the off-chain seed phrase generation process. The seed phrase acts as a mnemonic phrase that can be used as a master key to generate many private keys",
      "tags": [
        {
          "name": "User"
        }
      ],
      "params": [
        {
          "name": "pid",
          "description": "The user's Public Identity Data.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/PID"
          }
        },
        {
          "name": "pk",
          "description": "The user's Public Key (PK) to be associated with this PID for off-chain encryption.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/PK"
          }
        }
      ],
      "result": {
        "name": "transactionHash",
        "description": "A transaction hash or an identifier for the asynchronous operation.",
        "schema": {
          "type": "string",
          "pattern": "^0x[0-9a-fA-F]{64}$"
        }
      },
      "errors": [
        {
          "$ref": "#/components/errors/InvalidInput"
        },
        {
          "$ref": "#/components/errors/ProtocolError"
        }
      ]
    },
    {
      "name": "submitWord",
      "summary": "Allows a registered UIP node to submit an encrypted word fragment for a user's seed phrase.",
      "description": "This is part of the coordinated seed phrase generation process, where individual UIP nodes contribute encrypted words. The smart contract hashes and concatenates all received words once all entries are recorded, finalizing the seed phrase generation process.",
      "tags": [
        {
          "name": "Internal"
        },
        {
          "name": "UIP"
        }
      ],
      "params": [
        {
          "name": "pid",
          "description": "The PID for which the word fragment was generated.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/PID"
          }
        },
        {
          "name": "wordNumber",
          "description": "The 1-indexed position of the word in the seed phrase (1 to 24).",
          "required": true,
          "schema": {
            "type": "integer",
            "minimum": 1,
            "maximum": 24
          }
        },
        {
          "name": "encryptedWord",
          "description": "The word encrypted with the user's Public Key.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/EncryptedData"
          }
        }
      ],
      "result": {
        "name": "success",
        "description": "True if submission successful, false otherwise.",
        "schema": {
          "type": "boolean"
        }
      },
      "errors": [
        {
          "$ref": "#/components/errors/Unauthorized"
        },
        {
          "$ref": "#/components/errors/InvalidInput"
        },
        {
          "$ref": "#/components/errors/ProtocolError"
        }
      ]
    },
    {
      "name": "submitRedundantWord",
      "summary": "Allows a registered UIP node to submit a redundant copy of an encrypted word for robust distribution.",
      "description": "This method enhances fault tolerance by distributing encrypted word copies to other UIP nodes.",
      "tags": [
        {
          "name": "Internal"
        },
        {
          "name": "UIP"
        }
      ],
      "params": [
        {
          "name": "pid",
          "description": "The PID associated with the original word.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/PID"
          }
        },
        {
          "name": "originalWordNumber",
          "description": "The 1-indexed position of the original word.",
          "required": true,
          "schema": {
            "type": "integer",
            "minimum": 1,
            "maximum": 24
          }
        },
        {
          "name": "encryptedWord",
          "description": "The word encrypted for the target UIP node's Public Key.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/EncryptedData"
          }
        },
        {
          "name": "targetUipNodeAddress",
          "description": "The blockchain address of the UIP node for whom the word copy is encrypted.",
          "required": true,
          "schema": {
            "type": "string",
            "pattern": "^0x[0-9a-fA-F]{40}$"
          }
        }
      ],
      "result": {
        "name": "success",
        "description": "True if submission successful, false otherwise.",
        "schema": {
          "type": "boolean"
        }
      },
      "errors": [
        {
          "$ref": "#/components/errors/Unauthorized"
        },
        {
          "$ref": "#/components/errors/InvalidInput"
        }
      ]
    },
    {
      "name": "getSIDRecord",
      "summary": "Retrieves the SID record containing the SID, the encryption of the PID with the SK and the PK.",
      "description": "This method allows a NIP to retrieve their SID, which is the hash of the concatenated seed phrase words. The SID is encrypted with the user's Public Key (PK) for confidentiality.",
      "tags": [
        {
          "name": "Internal"
        },
        {
          "name": "NIP"
        }
      ],
      "params": [
        {
          "name": "SIDRecord",
          "description": "The Secret Identity Data (SID) record.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/SIDRecord"
          }
        }
      ],
      "errors": [
        {
          "$ref": "#/components/errors/NotFound"
        },
        {
          "$ref": "#/components/errors/InvalidInput"
        },
        {
          "$ref": "#/components/errors/ProtocolError"
        }
      ]
    },
    {
      "name": "storeSAC",
      "summary": "Stores a Secret Authentication Code (SAC) on the blockchain.",
      "description": "This method is used by the NIP to store a SAC, which is a hash of the user's seed phrase. The SAC is stored in a way that it can be later verified against an anonymous account's Public Key (PK).",
      "tags": [
        {
          "name": "Internal"
        },
        {
          "name": "NIP"
        }
      ],
      "params": [
        {
          "name": "sac",
          "description": "The Secret Authentication Code (SAC) to be stored.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/SAC"
          }
        }
      ]
    },
    {
      "name": "bindSACtoPK",
      "summary": "Registers the association between a Secret Authentication Code (SAC) and an anonymous account's Public Key (PK) on the blockchain.",
      "description": "This method is typically called by the NIP or an authorized service after SAC issuance to link the SAC to a specific anonymous account.",
      "tags": [
        {
          "name": "User"
        }
      ],
      "params": [
        {
          "name": "sac",
          "description": "The Secret Authentication Code (as bytes32 hash).",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/SAC"
          }
        },
        {
          "name": "anonymousAccountPk",
          "description": "The Public Key (PK) of the anonymous account.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/PK"
          }
        }
      ],
      "result": {
        "name": "success",
        "description": "True if the association is successfully stored, false otherwise.",
        "schema": {
          "type": "boolean"
        }
      },
      "errors": [
        {
          "$ref": "#/components/errors/InvalidInput"
        },
        {
          "$ref": "#/components/errors/Conflict"
        }
      ]
    },
    {
      "name": "checkSAC",
      "summary": "Verifies if a given SAC exists on the blockchain and is correctly associated with the provided anonymous account's Public Key.",
      "description": "This is a read-only method typically used by anonymous services for login verification.",
      "tags": [
        {
          "name": "Authentication Services"
        }
      ],
      "params": [
        {
          "name": "sac",
          "description": "The Secret Authentication Code to check.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/SAC"
          }
        },
        {
          "name": "anonymousAccountPk",
          "description": "The Public Key (PK) of the anonymous account to verify against.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/PK"
          }
        }
      ],
      "result": {
        "name": "isValid",
        "description": "True if the SAC exists and matches the provided PK, false otherwise.",
        "schema": {
          "type": "boolean"
        }
      },
      "errors": [
        {
          "$ref": "#/components/errors/InvalidInput"
        }
      ]
    },
    {
      "name": "getSACRecord",
      "summary": "Retrieves the Secret Authentication Code (SAC) associated with a Public Key (PK).",
      "description": "This method allows retrieval of the SAC for a specific anonymous account, which is used for authentication purposes.",
      "tags": [
        {
          "name": "Authentication Services"
        }
      ],
      "params": [
        {
          "name": "sac",
          "description": "The Secret Authentication Code.",
          "required": true,
          "schema": {
            "$ref": "#/components/schemas/SAC"
          }
        }
      ],
      "result": {
        "name": "SACRecord",
        "description": "The Secret Authentication Code (SAC) associated with the a Public Key.",
        "schema": {
          "$ref": "#/components/schemas/SACRecord"
        }
      }
    }
  ],
  "components": {
    "schemas": {
      "PID": {
        "type": "string",
        "description": "Public Identity Data, an anonymous token (e.g., UUID hash, bytes32 in Solidity).",
        "example": "0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b",
        "pattern": "^0x[0-9a-fA-F]{64}$"
      },
      "SID": {
        "type": "string",
        "description": "Secret Identity Data, a hash of concatenated word hashes (e.g., HEX string, bytes32 in Solidity).",
        "example": "0xabcde12345abcde12345abcde12345abcde12345abcde12345abcde12345abcde",
        "pattern": "^0x[0-9a-fA-F]{64}$"
      },
      "SIDRecord": {
        "type": "object",
        "properties": {
          "sid": {
            "$ref": "#/components/schemas/SID",
            "description": "The Secret Identity Data (SID) hash."
          },
          "pidEncryptedWithSK": {
            "$ref": "#/components/schemas/EncryptedData",
            "description": "The PID encrypted with the Secret Key (SK)."
          },
          "pkUserForSidEncryption": {
            "$ref": "#/components/schemas/PK",
            "description": "The Public Key used to encrypt the SID and PID."
          }
        },
        "required": ["sid", "pidEncryptedWithSK", "pkUserForSidEncryption"]
      },
      "PK": {
        "type": "string",
        "description": "Public Key, Base64 encoded cryptographic public key.",
        "example": "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FRODdB...",
        "pattern": "^0x[0-9a-fA-F]{128}$"
      },
      "SK": {
        "type": "string",
        "description": "Secret Key (conceptual, used off-chain for signing/decrypting). Not passed directly via RPC for security."
      },
      "SYMK": {
        "type": "string",
        "description": "Symmetric Key, Base64 encoded symmetric cryptographic key.",
        "example": "AABBCCDDIIJJEEFF"
      },
      "SignedPayload": {
        "type": "string",
        "description": "Base64 encoded string representing SIGN(payload, SK).",
        "example": "SIGNED_PAYLOAD_BASE64_STRING..."
      },
      "EncryptedData": {
        "type": "string",
        "description": "Base64 encoded string representing ENC(payload, Key).",
        "example": "ENCRYPTED_DATA_BASE64_STRING..."
      },
      "SeedPhraseRetrievalResult": {
        "type": "object",
        "properties": {
          "encryptedWords": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EncryptedData"
            },
            "description": "Array of individually encrypted words (each ENC(PID, wordnumber, word, PKuser))."
          },
          "encryptedSID": {
            "$ref": "#/components/schemas/EncryptedData",
            "description": "The SID encrypted with the user's Public Key (ENC(SID, PKuser))."
          },
          "symkEncryptedPidSidAssociation": {
            "$ref": "#/components/schemas/EncryptedData",
            "description": "The PID encrypted with the Symmetric Key (ENC(PID, SYMK)), mapped by SID."
          },
          "pkUserForSidEncryption": {
            "$ref": "#/components/schemas/PK",
            "description": "The Public Key used to encrypt the SID and seed phrase, allowing the client to decrypt."
          }
        }
      },
      "SAC": {
        "type": "string",
        "description": "Secret Authentication Code (e.g., bytes32 hash in Solidity).",
        "example": "0xdef456ghi789jkl012def456ghi789jkl012def456ghi789jkl012def456ghi789",
        "pattern": "^0x[0-9a-fA-F]{64}$"
      },
      "SACRecord": {
        "type": "object",
        "properties": {
          "sac": {
            "$ref": "#/components/schemas/SAC",
            "description": "The Secret Authentication Code associated with the Public Key."
          },
          "anonymousAccountPk": {
            "$ref": "#/components/schemas/PK",
            "description": "The Public Key of the anonymous account associated with the SAC."
          }
        },
        "required": ["sac", "anonymousAccountPk"]
      }
    },
    "errors": {
      "InvalidInput": {
        "code": -32602,
        "message": "Invalid input provided",
        "data": {
          "type": "string",
          "description": "Details about the validation error."
        }
      },
      "InternalError": {
        "code": -32603,
        "message": "Internal error occurred",
        "data": {
          "type": "string",
          "description": "An unexpected error occurred during processing."
        }
      },
      "MethodNotFound": {
        "code": -32601,
        "message": "Method not found",
        "data": {
          "type": "string",
          "description": "The requested method does not exist or is not implemented."
        }
      },
      "Unauthorized": {
        "code": 401,
        "message": "Unauthorized access",
        "data": {
          "type": "string",
          "description": "User or entity is not authorized to perform this action."
        }
      },
      "NotFound": {
        "code": 404,
        "message": "Resource not found",
        "data": {
          "type": "string",
          "description": "The requested resource (e.g., PID, SAC) could not be found."
        }
      },
      "ProtocolError": {
        "code": 500,
        "message": "Internal protocol error",
        "data": {
          "type": "string",
          "description": "An error occurred within the smart contract's internal logic or state."
        }
      },
      "Conflict": {
        "code": 409,
        "message": "Conflict",
        "data": {
          "type": "string",
          "description": "The operation could not be completed due to a conflict with existing data (e.g., SAC already registered)."
        }
      }
    }
  }
}
